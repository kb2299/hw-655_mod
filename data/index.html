<!doctype html>

<head>
  <meta charset="utf-8" />
  <title>Autolighter</title>
</head>

<body>
  <div id="main">
    <label>Light state:</label>
    <input id="button_light" type="button" value="Lights on">
    <div>
      <label id="debug"></label>
    </div>
  </div>

  <script>
    const button_light = document.getElementById('button_light');
    const debug_info = document.getElementById('debug');

    function status_update(data) {
      console.log(data)

      button_light.value = data.relay ? "Off" : "On";
      debug_info.innerHTML = JSON.stringify(data)
      setTimeout(getStatus, 2000);
    }

    async function getStatus() {
      try {
        let response = await fetch('/status');
        let data = await response.json();
        status_update(data)
      } catch (error) {
        console.error(error);
      }
    }

    async function lightSwitch() {
      var result;
      if (button_light.value === 'On') {
        let result = await fetch('/on');
      } else {
        let result = await fetch('/off');
      }

      // getStatus()
    }

    button_light.addEventListener('click', lightSwitch);

    getStatus()


  </script>


</body>

</html>